<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WCSim: Welcome to WCSim</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WCSim
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Welcome to WCSim </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>WCSim is a very flexible GEANT4 based program for developing and simulating large water Cherenkov detectors.</p>
<p>As of August 2014 WCSim has been moved to GitHub. It can be found at:</p>
<p><a href="https://github.com/WCSim/WCSim">https://github.com/WCSim/WCSim</a></p>
<p>Tutorials and information about the branches and WCSim development model can be found on the wiki:</p>
<p><a href="https://github.com/WCSim/WCSim/wiki">https://github.com/WCSim/WCSim/wiki</a></p>
<p>WCSim has very few external dependencies. It relies on only ROOT and Geant4.</p>
<p>There is a mailing list which will send you GitHub push/checkin notifications here:</p>
<p><a href="https://lists.phy.duke.edu/mailman/listinfo/wcsim-git">https://lists.phy.duke.edu/mailman/listinfo/wcsim-git</a></p>
<p>You can follow issues/requests etc by watching the GitHub respository.</p>
<h2>Validation Webpage</h2>
<p>WCSim uses GitHub Actions CI to perform build and physics tests for each pull request and commit. The scripts it runs can be found at <a href="https://github.com/WCSim/Validation">https://github.com/WCSim/Validation</a></p>
<p>The output can be found at: <a href="https://wcsim.github.io/Validation/">https://wcsim.github.io/Validation/</a></p>
<h2>Documentation</h2>
<p>More detailed information about the simulation is available in <code>doc/DetectorDocumentation.pdf</code></p>
<p>Additionally, doxygen documentation is available at <a href="https://wcsim.github.io/WCSim/annotated.html">https://wcsim.github.io/WCSim/annotated.html</a> Note that most of the code has no doxygen comments, but all output class member variables are documented. See the WCSimRoot* classes</p>
<p>doxygen documentation can be built locally by running </p><div class="fragment"><div class="line">cd $WCSIMDIR/ &amp;&amp; doxygen WCSim_doxygen_config</div></div><!-- fragment --><p>For admin: A more featured doxygen build can be done &amp; pushed using an alternative doxygen config file (requires <code>dot</code> from <code>graphviz</code>) </p><div class="fragment"><div class="line">git clone -b gh-pages --single-branch git@github.com:WCSim/WCSim.git WCSim-dox</div><div class="line">cd WCSim-dox</div><div class="line">./get_dox.sh</div></div><!-- fragment --><p> You can also make this featured version locally by </p><div class="fragment"><div class="line">cd $WCSIMDIR</div><div class="line">git clone -b gh-pages --single-branch git@github.com:WCSim/WCSim.git WCSim-dox</div><div class="line">doxygen WCSim-dox/WCSim_doxygen_config</div></div><!-- fragment --><h2>Build Instructions</h2>
<ul>
<li>The environment variable <code>$WCSIMDIR</code> should be defined as your WCSim code directory (not the build one). ``<code>bash export WCSIMDIR=</code>pwd<code> </code>``</li>
</ul>
<h3>Prerequisites</h3>
<p>The automated building testing is currently performed inside the hk-software docker container with the prerequisites:</p><ul>
<li>Geant4 10.3.3</li>
<li>ROOT 6.26/04</li>
<li>gcc 8.5.0</li>
<li>cmake 3.20.2</li>
</ul>
<p>And as such this is the most supported version of the software (it is guaranteed to work)</p>
<p>Other versions of prerequisite software can be tried, but aren't guaranteed to work.</p><ul>
<li>Geant 4.10.03p3<ul>
<li>If using a newer version of Geant, it is your responsiblity to assess whether Geant physics changes are significant, relative to the officially supported 4.10.03p3</li>
<li>All of the G4 data files are also required to be installed, include hadron xsec, etc.</li>
</ul>
</li>
<li>ROOT<ul>
<li>ROOT5 (e.g. v5r34p36 or v5r34p38, or potentially any v5r34) can potentially be made to work. You may need to modify <code>$WCSIM_BUILD_DIR/src/cmake_install.cmake</code> to take account of ROOT5 not producing <code>.pcm</code> files</li>
<li>ROOT6 has been tested on an older version than above (6.20/04)</li>
</ul>
</li>
<li>cmake 3.1 and above are required by <code>CMakeLists.txt</code>, but not all old versions have been tested</li>
<li>The compiler should support <code>-std=c++11</code> (or <code>-std=c++0x</code>) e.g. gcc 4.8.5<ul>
<li>You may need to modify <code>CMakeLists.txt</code> to change the <code>CMAKE_CXX_STANDARD</code> to another version (e.g. from 14 to 17). I <em>think</em> this is dependent on what your prerequisties have been compiled with</li>
</ul>
</li>
</ul>
<h3>Build Instructions using CMake:</h3>
<p>CMake is cross-platform software for managing the build process in a compiler-independent way (cmake.org). It is required to build ROOT and GEANT4 also through CMake. <b>Cmake 3.1+ is required.</b> Using cmake, builds and source code need to well separated and make it easier to build many versions of the same software.</p>
<p>A recommended way to set up the directory structure in your own preferred <code>WCSIM_HOME</code>:</p><ul>
<li><code>${WCSIM_HOME}/WCSim</code> : contains the src dir, typically the cloned or unzipped code from GitHub</li>
<li><code>${WCSIM_HOME}/WCSim_build</code> : contains directories for each build, eg. for each branch you want to test or for different releases, comparing debugged versions, etc. Each subdirectory like <code>WCSim_dev</code> or <code>WCSim_v1.2</code> would contain the intermediate files produced during compilation and not the finale ones</li>
<li><code>${WCSIM_HOME}/WCSim_install</code> : contains directories for each build, eg. for each branch you want to test or for different releases, comparing debugged versions, etc. Each subdirectory like <code>WCSim_dev</code> or <code>WCSim_v1.2</code> will contain the final executable and libraries, the example macros and library for ROOT.</li>
</ul>
<p>To compile you need to have <code>CMakeLists.txt</code> in the WCSim source dir.</p><ul>
<li><code>mkdir -p ${WCSIM_HOME}/WCSim_build/mydir ; cd ${WCSIM_HOME}/WCSim_build/mydir</code></li>
<li>Set up the environment variables <div class="fragment"><div class="line">#WCSim things</div><div class="line">export WCSIMDIR=/${WCSIM_HOME}/WCSim</div><div class="line">export G4WORKDIR=$WCSIMDIR/exe</div><div class="line">#Geant4 things</div><div class="line">export G4INSTALLDIR=/path/to/geant4/install/dir/</div><div class="line">source $G4INSTALLDIR/bin/geant4.sh</div><div class="line">source $G4INSTALLDIR/share/Geant4-10.3.3/geant4make/geant4make.sh</div></div><!-- fragment --></li>
<li><code>cmake3 ../../WCSim</code> : this executes the commands in <code>CMakeLists.txt</code> and generates the Makefiles for both the ROOT library as the main executable.<ul>
<li>For some OS, <code>cmake3</code> is just <code>cmake</code></li>
</ul>
</li>
<li><code>make clean</code> : if necessary</li>
<li><code>make -j3 install</code> : will first compile the libWCSimRoot.so and libWCSimCore.so which you need for using the ROOT Dict from WCSim (e.g. to read the output files) and then compile WCSim.</li>
<li><code>source bin/this_wcsim.sh</code> : will setup the environment variables such that you can run WCSim</li>
</ul>
<p>To recompile:</p><ul>
<li>Typically just <code>make install</code> will be enough and also redo the cmake phase if something changed.</li>
<li>Sometimes you need to <code>make clean</code> first.</li>
<li>When there are problems, try removing <code>CMakeCache.txt</code>, and redo the cmake.</li>
</ul>
<p>Useful cmake commands:</p><ul>
<li><code>make edit_cache</code> : customize the build.</li>
<li><code>make rebuild_cache</code> : redo the cmake phase.</li>
</ul>
<h4>WCSim cmake build options</h4>
<ul>
<li><code>-DWCSim_Geometry_Overlaps_CHECK=&lt;ON|OFF&gt;</code> If ON, turns on geometry overlap checking (slow, but important when setting new detector geometry options). Default: OFF</li>
<li><code>-DWCSim_DEBUG_COMPILE_FLAG=&lt;ON|OFF&gt;</code> If ON, turns on the gcc debug compiler flag <code>-g</code>. Default: OFF</li>
<li><code>-DWCSIM_SAVE_PHOTON_HISTORY_FLAG=&lt;ON|OFF&gt;</code> If ON, turns on photon scattering/reflection history saving. The data class <code><a class="el" href="class_w_c_sim_root_cherenkov_hit_history.html" title="Class holding scattering and reflection history for each true hit (Cherenkov photon; dark noise are a...">WCSimRootCherenkovHitHistory</a></code> is used in a similar way as <code><a class="el" href="class_w_c_sim_root_cherenkov_hit_time.html" title="Class holding true (Cherenkov photon + dark noise) hit information. ">WCSimRootCherenkovHitTime</a></code>. Default: OFF</li>
</ul>
<h4>Build with CMake on sukap:</h4>
<p>A script allowing to build WCSim with CMake on sukap is available: </p><div class="fragment"><div class="line">cd $WCSIMDIR</div><div class="line">./setup/env_sukap.sh</div><div class="line">./make.sh</div></div><!-- fragment --><p> Note that <code>./make.sh</code> should also work on other systems.</p>
<p>This script will read the current WCSim directory name and create a directory to hold the different cmake builds. For example, in case your current WCSim directory name is 'WCSim', it will create a '../WCSim-build' directory. It will also create a <code>../WCSim-install</code> directory.</p>
<p>It will then create a directory for your current branch which will have the name of the current branch. For example, in case your current branch name is <code>hybridPMT</code>, you will have: </p><div class="fragment"><div class="line">WCSim/</div><div class="line">WCSim-build/</div><div class="line">WCSim-build/hybridPMT/</div><div class="line">WCSim-install/</div><div class="line">WCSim-install/hybridPMT/</div></div><!-- fragment --><p>Note that by defaul, just <code>make install</code> is run. You can run <code>make clean</code> before <code>make install</code> by running <code>./make.sh clean</code></p>
<h3>Build Instructions using GNUmakefile:</h3>
<p><code>GNUmakefile</code>` is specifically only for use with ROOT5 and is not supported otherwise. All output that needs to be trusted must use cmake. To compile: </p><div class="fragment"><div class="line">make clean_wcsim</div><div class="line">make rootcint</div><div class="line">make</div></div><!-- fragment --><h3>Using WCSim without building using Docker:</h3>
<p>Docker allows you to use WCSim without compiling in an OS independant way. The Docker images are hosted on DockerHub and can be used by following the steps below.</p>
<p>1) Install Docker cross platform instructions can be found at <a href="https://www.docker.com/">https://www.docker.com/</a> 2) Pull the WCSim image from docker hub by using <code>docker pull wcsim/wcsim:tag</code> where <code>tag</code> is the tagged version or use the tag <code>latest</code> to get the current develop branch 3) Run the docker image and create a container <code>docker run --name=WCSim -i -t wcsim/wcsim:tag</code> this will give you a shell in the container's OS with WCSim already built. To save data from inside your docker image mount a local folder in the docker image at runtime and then anything placed in that directory will be available in that folder after exit. To do that run the following <code>docker run -v local_folder_path:docker_mount_path -i -t wcsim/wcsim:tag</code> 4) Once you have run the docker image, you will already be in <code>$WCSIMDIR</code> and WCSim (and prerequisites) will be setup. Therefore, you can just start running WCSim as normal from this directory 5) To exit the docker image <code>exit</code></p>
<p>(Note: You only need to use the <code>docker run</code> command once to create the container. Once created you changes are saved in that container instance and you can start and stop the container at any time with <code>docker start WCSim</code> and <code>docker stop WCSim</code>);</p>
<p>Extra docker commands: 1) See all images <code>docker images</code> 2) Delete an image <code>docker rmi imageID</code> 3) See all containers <code>docker ps -a</code> 4) Delete a container <code>docker rm ContainerID</code></p>
<p>Note that this method currently uses make (not cmake) to build</p>
<h3>Using WCSim without building using Singularity</h3>
<p>Singularity is a similar container tool with different philosphies. The most important being that you can't run as root. This means that it may be installed and available to use on your local cluster.</p>
<p>You should be able to run the docker container with singularity without any problems. Just to note that <code>$WCSIMDIR</code> will be read-only, therefore you should run WCSim elsewhere (if you forget you'll see a nasty seg fault - this is just because of the read-only directory).</p>
<p>Note that this method currently uses make (not cmake) to build</p>
<h2>Running WCSim</h2>
<p>To test that WCSim is working, try running the test macro <code>WCSim.mac</code>, which runs 10 electrons with 5 MeV of energy in the Super-Kamiokande detector (it should take less than a minute to run).</p>
<div class="fragment"><div class="line">cd /path/to/wcsim/build/dir/</div><div class="line">./WCSim WCSim.mac macros/tuning_parameters.mac</div></div><!-- fragment --><p><code>WCSim.mac</code> is well commented. Take a look inside (and also at other <code>.mac</code> files in <code>/macros/</code>) for the various options you can use to run WCSim</p>
<h2>Analysing the output of WCSim</h2>
<p>There are a few example scripts inside <code>sample-root-scripts/</code></p>
<ul>
<li><code><a class="el" href="sample__readfile_8_c.html">sample_readfile.C</a></code> is a general script that allows you to see (most) event-level variables</li>
<li>For the hybrid geometry, see <code><a class="el" href="_analyze_w_s_hierarchy_8c.html">AnalyzeWSHierarchy.c</a></code><ul>
<li>Compile it using the <code>Makefile</code> in <code>sample-root-scripts/</code> (i.e. run <code>make</code> from that folder)</li>
<li>Execute it using <code>Analyzer.sh</code> in <code>sample-root-scripts/</code> (i.e. run <code>./Analyzer.sh</code> from that folder)</li>
</ul>
</li>
</ul>
<h2>Color Convention for visualization used in <code><a class="el" href="_w_c_sim_vis_manager_8cc.html">WCSimVismanager.cc</a></code></h2>
<ul>
<li>gamma = green</li>
<li>neutrino = yellow</li>
<li>electron = blue</li>
<li>positron = red</li>
<li>muon = white</li>
<li>muon+ = silver</li>
<li>proton = magenta</li>
<li>neutron = cyan</li>
</ul>
<div class="fragment"><div class="line">WCSim development is supported by the United States National Science Foundation.</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 30 2024 12:34:00 for WCSim by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
